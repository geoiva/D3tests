<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head><title>world map</title>
    <script src="../lib/d3.v3.min.js"></script>
    <script src="../lib/topojson.min.js"></script>
<!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
<link rel="stylesheet" type="text/css" href="../lib/maps.css">
<style>
    .boundary {
        fill: #eee;
        stroke: #999;
    }
    .svgFrame {
        fill: none;
        stroke: #999;
    }
    #mapDiv {
        margin: 10px;
    }
    .q0-9 { fill:rgb(247,251,255); }
    .q1-9 { fill:rgb(222,235,247); }
    .q2-9 { fill:rgb(198,219,239); }
    .q3-9 { fill:rgb(158,202,225); }
    .q4-9 { fill:rgb(107,174,214); }
    .q5-9 { fill:rgb(66,146,198); }
    .q6-9 { fill:rgb(33,113,181); }
    .q7-9 { fill:rgb(8,81,156); }
    .q8-9 { fill:rgb(8,48,107); }
</style>


<script>

var SVGwidth = 600, SVGheight = 500;

var mapDiv, svg, svgpath,  worldgeom;

////choose scale that fills box
//var xscale = SVGwidth/360;
//var yscale = SVGheight/180;
//var mapscale = Math.min(xscale,yscale);



function init() {

    mapDiv = d3.select("#mapDiv");

    svg = mapDiv.append("svg")
        .attr("id", "theMapSVG")
        .attr("width", SVGwidth)
        .attr("height", SVGheight)
    ;


    var rateById = d3.map();

    var quantize = d3.scale.quantize()
            .domain([0, .15])
            .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }));

    //Define map projection
    var projection = d3.geo.mercator()
            .rotate([0,0]) //lon,lat]
            .center([0,0]) //[lon,lat]
            .translate([SVGwidth/2, SVGheight/2])
            .precision(0.1)
            .scale(100);
    //Define path generator
    svgpath = d3.geo.path()
            .projection(projection);


//    queue()
//        .defer(d3.json, "../data/world-50m.json")
//        .defer(d3.csv, "data.csv", function(d) { rateById.set(d.id, + d.rate); })
//        .await(ready);

    d3.json("../data/world-50m.json", function(json) {
        worldgeom=json;
        svg.append("g")
                .attr("class", "boundary")
                .selectAll("path")
                .data(topojson.feature(worldgeom, worldgeom.objects.countries).features)
                .enter().append("path")
//                .attr("class", function(d) { return quantize(rateById.get(d.id)); })
                .attr("d", svgpath);

    });


//        svg.append("path")
//                .datum(topojson.mesh(worlddata, worlddata.objects.states, function(a, b) { return a !== b; }))
//                .attr("class", "states")
//                .attr("d", path);

}


function fitToBox() {
    SVGwidth = d3.select("#width")[0][0].value;
    SVGheight = d3.select("#height")[0][0].value;
    svg.remove();
    init();
}

</script>

</head>
<body onload="init()">

<p>D3 API used to map the world...</p>
<div id="mapDiv">
</div>



</body>
</html>
